<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recommandation de Fournisseurs Durables</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
</head>
<body>
    <header>
        <div class="header-container">
            <div class="logo">
                <i class="fas fa-leaf"></i>
                <h1>Eco<span>VISION</span></h1>
            </div>
            <nav>
                <ul>
                    <li><a href="/" class="active"><i class="fas fa-home"></i> Accueil</a></li>
                    <li><a href="/recommendations"><i class="fas fa-award"></i> Recommandations</a></li>
                    <li><a href="#" id="analysisBtn"><i class="fas fa-brain"></i> Analyse IA</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <section class="hero">
            <div class="hero-content">
                <h2>Optimisez votre chaîne d'approvisionnement durable</h2>
                <p>Utilisez notre intelligence artificielle pour identifier les fournisseurs les plus écologiques et durables pour votre entreprise.</p>
                <div class="cta-buttons">
                    <a href="/recommendations" class="btn primary-btn">Voir les recommandations</a>
                    <a href="#" id="aiAnalysisBtn" class="btn secondary-btn">Analyse IA avancée</a>
                </div>
            </div>
            <div class="hero-image">
                <img src="https://th.bing.com/th/id/R.a4f7aa3cb78d8e484fafc8dd8c1828c8?rik=QBA27JiwXBtZlQ&riu=http%3a%2f%2fgeometre-chateaurenard.com%2fwp-content%2fuploads%2f2014%2f05%2fDeveloppement_durable.jpg&ehk=6TEWd9qK5RpOk3%2bCxkN0dIx20g3iL4ln6fUmS86JeM0%3d&risl=&pid=ImgRaw&r=0" alt="Illustration développement durable" onerror="this.src='/api/placeholder/500/300'; this.onerror=null;">
            </div>
        </section>

        <section class="features">
            <h2>Fonctionnalités principales</h2>
            <div class="feature-cards">
                <div class="feature-card">
                    <div class="icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h3>Scores de durabilité</h3>
                    <p>Analysez les scores de durabilité de vos fournisseurs basés sur plusieurs critères environnementaux</p>
                </div>
                <div class="feature-card">
                    <div class="icon">
                        <i class="fas fa-solar-panel"></i>
                    </div>
                    <h3>Énergie renouvelable</h3>
                    <p>Comparez l'utilisation d'énergie renouvelable parmi vos fournisseurs</p>
                </div>
                <div class="feature-card">
                    <div class="icon">
                        <i class="fas fa-truck-moving"></i>
                    </div>
                    <h3>Empreinte carbone</h3>
                    <p>Visualisez l'empreinte carbone de votre chaîne d'approvisionnement</p>
                </div>
                <div class="feature-card">
                    <div class="icon">
                        <i class="fas fa-brain"></i>
                    </div>
                    <h3>Analyse IA</h3>
                    <p>Obtenez des recommandations intelligentes basées sur l'analyse de données massives</p>
                </div>
            </div>
        </section>

        <section class="dashboard-preview">
            <h2>Aperçu du tableau de bord</h2>
            <div class="dashboard-container">
                <div class="chart-container">
                    <h3>Score de durabilité des top fournisseurs</h3>
                    <canvas id="sustainabilityChart"></canvas>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal pour l'analyse IA -->
    <div id="aiAnalysisModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2><i class="fas fa-brain"></i> Analyse IA des fournisseurs durables</h2>
            <div class="loader" id="analysisLoader">
                <div class="spinner"></div>
                <p>Analyse en cours...</p>
            </div>
            <div id="analysisContent" class="analysis-content"></div>
        </div>
    </div>

    <footer>
        <div class="footer-container">
            <div class="footer-logo">
                <i class="fas fa-leaf"></i>
                <h2>Eco<span>VISION</span></h2>
            </div>
            <div class="footer-links">
                <h3>Liens rapides</h3>
                <ul>
                    <li><a href="/">Accueil</a></li>
                    <li><a href="/recommendations">Recommandations</a></li>
                    <li><a href="#">À propos</a></li>
                    <li><a href="#">Contact</a></li>
                </ul>
            </div>
            <div class="footer-contact">
                <h3>Contact</h3>
                <p><i class="fas fa-envelope"></i> contact@ecovision.com</p>
                <p><i class="fas fa-phone"></i> +216 1 23 45 67 89</p>
            </div>
        </div>
        <div class="copyright">
            <p>&copy; 2025 EcoVision. Tous droits réservés.</p>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>
        // Charger quelques données pour le graphique de démonstration
        document.addEventListener('DOMContentLoaded', () => {
            // Récupérer les données des fournisseurs pour le graphique
            fetch('/api/recommendations?count=5')
                .then(response => response.json())
                .then(data => {
                    if (data.visualization_data) {
                        createSustainabilityChart(data.visualization_data);
                    }
                })
                .catch(error => {
                    console.error('Erreur lors du chargement des données:', error);
                });
        });

        // Créer le graphique de durabilité
        function createSustainabilityChart(data) {
            const ctx = document.getElementById('sustainabilityChart').getContext('2d');
            const chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.supplier_names,
                    datasets: [{
                        label: 'Score de durabilité',
                        data: data.sustainability_scores,
                        backgroundColor: 'rgba(75, 192, 192, 0.7)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Score (0-100)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Fournisseurs'
                            }
                        }
                    }
                }
            });
        }

        // Gestion du modal d'analyse IA
        const modal = document.getElementById("aiAnalysisModal");
        const btn = document.getElementById("analysisBtn");
        const aiBtn = document.getElementById("aiAnalysisBtn");
        const span = document.getElementsByClassName("close")[0];
        const loader = document.getElementById("analysisLoader");
        const content = document.getElementById("analysisContent");

        function openAnalysisModal() {
            modal.style.display = "block";
            loader.style.display = "flex";
            content.style.display = "none";
            content.innerHTML = "";
            
            // Charger l'analyse IA
            fetch('/api/llm_analysis')
                .then(response => response.json())
                .then(data => {
                    loader.style.display = "none";
                    content.style.display = "block";
                    
                    // Convertir le markdown en HTML (version simplifiée)
                    let html = marked.parse(data.analysis);
                    content.innerHTML = html;
                    
                    // Ajouter la section des meilleurs fournisseurs
                    let suppliersHTML = '<div class="top-suppliers"><h3>Top 3 Fournisseurs Recommandés</h3><div class="supplier-cards">';
                    
                    data.top_suppliers.forEach(supplier => {
                        suppliersHTML += `
                            <div class="supplier-card">
                                <h4>${supplier.supplier_name}</h4>
                                <div class="supplier-score">
                                    <span class="score-value">${supplier.sustainability_score.toFixed(1)}</span>
                                    <span class="score-label">/100</span>
                                </div>
                                <p><strong>Énergie renouvelable:</strong> ${supplier.renewable_energy_percentage.toFixed(1)}%</p>
                                <p><strong>Empreinte carbone:</strong> ${supplier.avg_carbon_footprint.toFixed(2)} kgCO2e</p>
                                <a href="/details/${supplier.supplier_id}" class="btn small-btn">Détails</a>
                            </div>
                        `;
                    });
                    
                    suppliersHTML += '</div></div>';
                    content.innerHTML += suppliersHTML;
                })
                .catch(error => {
                    loader.style.display = "none";
                    content.style.display = "block";
                    content.innerHTML = `<p class="error">Erreur lors du chargement de l'analyse: ${error}</p>`;
                });
        }

        btn.onclick = openAnalysisModal;
        aiBtn.onclick = openAnalysisModal;

        span.onclick = function() {
            modal.style.display = "none";
        }

        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.0.2/marked.min.js"></script>
</body>
</html>